{% extends 'base.html' %}
{% set title = current_user.username ~ " | Dashboard" %}

{% block content %}
<!-- DASHBOARD PROFILE HEADER -->
<section class="container py-5">
    <div class="text-center mb-5">
        {% if current_user.profile_pic %}
            <img src="{{ url_for('static', filename='uploads/' ~ current_user.profile_pic) }}" 
                 class="profile-pic mb-3"
                 onerror="this.src='{{ url_for('static', filename='images/default_profile.png') }}'">
        {% else %}
            <img src="{{ url_for('static', filename='images/default_profile.png') }}" 
                 class="profile-pic mb-3">
        {% endif %}

        <h1 class="display-5 fw-bold mb-2">{{ current_user.username }}</h1>
        <p class="text-secondary mb-3" style="font-size: 1.1rem;">{{ current_user.email }}</p>
        
        {% if active %}
            <div class="d-inline-block mb-3">
                <span class="badge" style="background: linear-gradient(135deg, var(--cr-orange), var(--cr-red)); padding: 0.75rem 1.5rem; font-size: 1rem;">
                    üíé {{ active.plan.name }} ‚Äî Valid until {{ active.end_date.strftime('%B %d, %Y') }}
                </span>
            </div>
        {% else %}
            <div class="mb-3">
                <span class="badge bg-warning text-dark mb-3" style="padding: 0.75rem 1.5rem; font-size: 1rem;">
                    ‚ö†Ô∏è No active subscription
                </span>
                <div>
                    <a href="{{ url_for('subscriptions') }}" class="btn btn-primary mt-2">
                        Subscribe Now
                    </a>
                </div>
            </div>
        {% endif %}
    </div>
</section>

<!-- WATCHLIST MOVIES -->
<section class="container py-4">
    <div class="sv-section">
        <h2 class="sv-section-title">Your Watchlist</h2>
        
        {% if movies and movies|length > 0 %}
            <div class="row g-4">
                {% for movie in movies %}
                <div class="col-6 col-sm-4 col-md-3 col-xl-2">
                    <div class="sv-tile">
                        <a href="{{ url_for('movie_detail', movie_id=movie.id) }}" style="text-decoration: none; color: inherit;">
                            <img src="{{ movie.poster_url or url_for('static', filename='images/default_poster.jpg') }}" 
                                 alt="{{ movie.title }}"
                                 onerror="this.src='{{ url_for('static', filename='images/default_poster.jpg') }}'">
                            {% if movie.tags and 'premium' in movie.tags|lower %}
                                <div class="sv-premium-badge">Premium</div>
                            {% endif %}
                            <div class="sv-tile-overlay">
                                <div class="sv-tile-actions">
                                    <a class="btn btn-sm btn-danger" href="{{ url_for('movie_detail', movie_id=movie.id) }}" onclick="event.stopPropagation();">
                                        ‚ñ∂ Watch
                                    </a>
                                </div>
                            </div>
                        </a>
                    </div>
                    <div class="sv-tile-meta mt-2">
                        <div class="sv-title">{{ movie.title }}</div>
                        {% if movie.genre %}<div class="sv-genre">{{ movie.genre }}</div>{% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="text-center py-5">
                <div class="mb-4">
                    <span style="font-size: 4rem;">üì∫</span>
                </div>
                <h3 class="mb-3" style="color: var(--cr-text-secondary);">Your Watchlist is Empty</h3>
                <p class="text-secondary mb-4">Start building your collection by adding movies you want to watch!</p>
                <a href="{{ url_for('home') }}" class="btn btn-primary btn-lg">
                    Browse Movies
                </a>
            </div>
        {% endif %}
    </div>
</section>
{% endblock %}
